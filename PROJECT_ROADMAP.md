# 냥링크 (Nyan-Link) 프로젝트 작업 계획서

## 📋 프로젝트 개요
- **프로젝트명**: 냥링크 (Nyan Link)
- **장르**: 하이브리드 퍼즐 RPG (러너 & 헥사곤 퍼즐 + 수집형 RPG)
- **플랫폼**: 모바일 (Android / iOS) - Portrait 모드
- **엔진**: Unity 6.0+

---

## 🎯 전체 작업 단계 개요

프로젝트를 **8개의 주요 단계(Phase)**로 나누어 진행합니다. 각 단계는 독립적으로 테스트 가능하며, 단계별로 완료 후 다음 단계로 진행합니다.

```
Phase 1: 데이터 구조 및 인프라 구축
  ↓
Phase 2: 퍼즐 시스템 핵심 구현
  ↓
Phase 3: 특수 아이템 시스템
  ↓
Phase 4: 러너 시스템 및 장애물
  ↓
Phase 5: 보스 전투 시스템
  ↓
Phase 6: 성장 시스템 (캐릭터/장비)
  ↓
Phase 7: UI/UX 구현
  ↓
Phase 8: 밸런싱 및 최적화
```

---

## 📌 Phase 1: 데이터 구조 및 인프라 구축

### 목표
게임의 모든 데이터를 정의하고, 외부에서 관리할 수 있는 구조를 만듭니다.

### 작업 내용
1. **Enum 정의**
   - `TileColor` (Red, Blue, Yellow, Purple, Orange, Cyan)
   - `ItemEffectType` (Recovery, TimeFreeze, Blast, LineClear, PowerUp, Rainbow)
   - `EquipmentGrade` (Grey, Green, Blue, Purple, Yellow)
   - `EquipmentType` (Hat, Outfit, Weapon)
   - `BossBattleType` (TimeAttack, RhythmNote, ColorQuota, MemorySequence)
   - `RunnerState` (Run, Jump, Slide, Block, Attack, Invincible, Stumble)

2. **ScriptableObject 데이터 구조 생성**
   - `GridShapeData`: 벌집형 그리드 모양 정의
   - `TileEffectData`: 타일별 효과 수치 (회복량, 지속시간 등)
   - `CharacterData`: 캐릭터 기본 스탯
   - `EquipmentData`: 장비 정보 (보스 전용 장비 포함)
   - `LootTableData`: 보스 드롭 테이블
   - `BossBattleConfig`: 보스 전투 설정
   - `StageData`: 스테이지 정보

3. **밸런싱 데이터 테이블 구조**
   - `BalanceData`: 모든 수치를 외부에서 관리
     - 스태미나 감소율
     - 점수 계산 계수
     - 체인 티어 기준 (Middle: 5~8개, Long: 9개 이상)
     - 아이템 효과 수치 (Lv.1, Lv.2)

4. **헥사곤 좌표계 시스템**
   - `HexCoordinates`: Offset ↔ Cube 변환
   - `HexUtils`: 인접 타일 탐색, 거리 계산

5. **기본 매니저 클래스**
   - `GameManager`: 게임 상태 관리 (싱글톤)
   - `DataManager`: ScriptableObject 로드 및 관리

### 예상 소요 시간
**3-5일**

### 완료 기준
- 모든 Enum이 정의됨
- ScriptableObject 구조가 완성되고 에디터 메뉴에서 생성 가능
- 헥사곤 좌표계 변환이 정확히 동작
- 밸런싱 데이터를 외부에서 수정 가능

---

## 📌 Phase 2: 퍼즐 시스템 핵심 구현 ✅ **완료**

### 목표
헥사곤 타일 퍼즐의 핵심 조작 및 매칭 시스템을 구현합니다.

### 작업 내용
1. **벌집형 그리드 생성** ✅
   - `PuzzleBoardManager`: 그리드 생성 및 관리
   - 홀수/짝수 열 교차 배치 로직 (짝수 열에 타일 1개 추가로 균형 맞춤)
   - `GridShapeData`를 이용한 쉐이프 마스크 적용
   - **Unity Tilemap Offset 좌표계 직접 사용** (HexCoordinates 제거)
   - 중앙 타일 (0, 0, 0) 기준 그리드 배치

2. **타일 인스턴스 시스템** ✅
   - `TileInstance`: 타일 데이터 구조
   - Offset 좌표 기반 위치 관리
   - **타일 상태 관리 (TileState enum: Normal, ItemLv1, ItemLv2)**
   - 타일 풀링 시스템 (ObjectPool 사용) - **참고**: Unity Tilemap은 GameObject가 아니므로 TileInstance 데이터 구조만 풀링 가능. 성능상 큰 이점이 없어 Phase 8에서 선택적 구현 예정.

3. **입력 처리** ✅
   - `TileInputHandler`: 터치/드래그 입력 처리
   - 마우스 이동 민감도 설정으로 중복 호출 방지
   - 마지막 선택 타일 기준 인접 타일 검증
   - 드래그 중 타일 선택/취소 로직
   - Back-track (되돌아가기) 처리

4. **타일 매칭 로직** ✅
   - `TileMatcher`: 인접 타일 매칭 판정
   - `HexOffsetUtils`: Offset 좌표 기반 인접 타일 탐색 및 거리 계산
   - 동일 색상 2개 이상 연결 시 매칭
   - 다른 색상 선택 시 이전 선택 취소
   - Back-track (되돌아가기) 처리

5. **타일 제거 및 스폰** ✅
   - 매칭된 타일 즉시 제거 (애니메이션은 선택적)
   - 제자리 즉시 스폰 (중력 낙하 없음)
   - 새 타일 색상 랜덤 생성 (모든 색상: Red, Blue, Yellow, Purple, Orange, Cyan)
   - 추후 색상별 등장 확률 조정 가능하도록 구조 설계

6. **시각적 피드백** ✅
   - `TileSelectionVisualizer`: 선택된 타일 체인 연결선 표시
   - LineRenderer를 사용한 직선 연결
   - 타일 위에 표시되도록 렌더링 순서 조정 (Z 위치 및 View 모드)

7. **AnimatedTile 시스템** ✅
   - 18개 AnimatedTile 에셋 자동 생성 (6색상 × 3상태)
   - 색상별 스프라이트 생성 및 관리
   - 상태별 타일 전환 지원 (`SetTileState`)
   - 타일맵 타일 앵커 설정 (셀 중심: 0.5, 0.5, 0)
   - 에디터에서 AnimatedTile 자동 로드 (`LoadAnimatedTiles`)

### 예상 소요 시간
**5-7일** (실제 완료: 2026-01-23)

### 완료 기준
- [x] ✅ 벌집형 그리드가 정확히 생성됨
- [x] ✅ 드래그로 타일을 연결할 수 있음
- [x] ✅ 매칭된 타일이 제거되고 새 타일이 생성됨
- [x] ✅ 터치 보정이 적용되어 조작이 부드러움
- [x] ✅ 시각적 피드백 (연결선) 구현 완료
- [x] ✅ 좌표계 통일 (Unity Offset 좌표계)

### 주요 기술 결정
- **좌표계**: Unity Tilemap Offset 좌표계 직접 사용 (HexCoordinates 제거)
- **인접 타일 계산**: 양방향 검증으로 대칭성 보장
- **렌더링**: LineRenderer의 Z 위치 조정 및 View 모드로 타일 위에 표시
- **타일 시스템**: AnimatedTile 사용 (2D Tilemap Extras 패키지)
- **타일 앵커**: 셀 중심 (0.5, 0.5, 0)으로 설정하여 스프라이트 pivot과 일치
- **스프라이트 생성**: 색상별 스프라이트 생성 시 pivot 정규화 처리

---

## 📌 Phase 3: 특수 아이템 시스템

### 목표
체인 길이에 따라 타일맵에 생성되는 특수 아이템 타일을 구현하고, 타일 제거 시 효과를 발동시킵니다.

### 작업 내용
1. **체인 티어 판정**
   - `ChainEvaluator`: 체인 길이에 따른 티어 계산
   - Middle Chain (5~8개): Lv.1 효과
   - Long Chain (9개 이상): Lv.2 효과

2. **아이템 타일 생성 로직**
   - 체인 조건 만족 시 **마지막 타일 위치에 동일 색상의 아이템 효과를 가진 타일**을 **타일맵에 직접 생성**
   - 예: 빨간색 체인으로 제거한 경우 → 마지막 위치에 Recovery 효과를 가진 빨간색 타일이 타일맵에 생성
   - 특수 타일은 시각적으로 다르게 표현 (아이템 효과 아이콘/이펙트 표시)
   - **나머지 제거된 공간에는 랜덤으로 효과 없는 일반 타일 생성**
   - **아이템 타일 제한 시스템**:
     - 전체 타일맵에서 아이템 효과를 가진 타일은 최대 2개까지 존재 가능 (조절 가능)
     - 추후 캐릭터에 따라 추가 보유 가능하도록 구조 설계
     - 타일맵에 정해진 수량 이상이 있으면 더 이상 아이템 효과를 가진 타일은 생성되지 않음
     - 아이템 종류와 관계없이 전체 합계로 제한 (예: Recovery 1개 + Blast 1개 = 최대 2개)
   - `ItemEffectData`에서 효과 수치 로드
   - **참고**: Phase 2에서 모든 색상(6가지) 랜덤 생성 구조 준비 완료

3. **아이템 효과 구현**
   - **타일 관련 효과 (Phase 3에서 완전 구현)**:
     - **Yellow (Blast)**: 주변 범위 타일 파괴
     - **Purple (LineClear)**: 가로/대각선 라인 제거
     - **Cyan (Rainbow)**: Rainbow Tile 생성 또는 Rainbow Bomb 발동
   - **시스템 의존 효과 (이벤트 기반, Phase 4/5에서 실제 동작)**:
     - **Red (Recovery)**: 스태미나 즉시 회복 → 이벤트 발행 (Phase 4에서 구독)
     - **Blue (TimeFreeze)**: 스태미나 감소/타이머 정지 → 이벤트 발행 (Phase 4에서 구독)
     - **Orange (PowerUp)**: 다음 보스 공격 대미지 증가 → 이벤트 발행 (Phase 5에서 구독)
   - **참고**: Phase 3에서는 이벤트 시스템(`ItemEffectEvents`)을 통해 효과를 발행하고, Phase 4/5에서 실제 시스템과 연결하여 동작하도록 설계

4. **아이템 타일 사용 로직**
   - 타일맵에 배치된 아이템 효과를 가진 타일을 **연결해서 제거할 때** 효과가 발생
   - 체인에 포함된 모든 아이템 타일의 효과가 각각 발동
   - 동일한 종류의 아이템 타일이 여러 개 포함되어도 각각 효과 발동
   - 예: Recovery 타일 1개 + Blast 타일 1개를 동시에 연결 제거 → Recovery 효과 + Blast 효과 모두 발동

5. **아이템 타일 시각적 표현**
   - 아이템 효과를 가진 타일은 일반 타일과 구분되도록 시각적 표시
   - 아이콘 오버레이 또는 특수 이펙트 표시
   - 효과 레벨(Lv.1/Lv.2)에 따른 시각적 차별화

### 예상 소요 시간
**4-6일**

### 완료 기준
- 체인 길이에 따라 올바른 티어 아이템 타일이 타일맵에 생성됨
- 전체 타일맵 아이템 타일 최대 개수 제한이 정확히 동작함
- 타일맵에 아이템 타일이 최대 개수 이상일 때 더 이상 생성되지 않음
- 아이템 타일을 연결 제거할 때 효과가 정확히 발동함
- 여러 아이템 타일이 동시에 제거될 때 모든 효과가 각각 발동함
- 동일 종류 아이템 타일도 각각 효과가 발동함
- 타일 관련 효과(Blast, LineClear, Rainbow)가 정확히 동작함
- 시스템 의존 효과(Recovery, TimeFreeze, PowerUp)가 이벤트를 정확히 발행함
- 아이템 타일 사용 시 시각적 피드백이 표시됨
- **참고**: Recovery, TimeFreeze, PowerUp 효과는 Phase 3에서 이벤트만 발행하고, 실제 동작은 Phase 4/5에서 구현됨

---

## 📌 Phase 4: 러너 시스템 및 장애물

### 목표
상단 뷰의 러너 액션과 장애물 시스템을 구현합니다.

### 작업 내용
1. **러너 상태 머신**
   - `RunnerController`: 캐릭터 제어
   - `RunnerStateMachine`: 상태 전환 관리
   - 상태별 애니메이션 및 액션 처리

2. **색상별 액션 매핑**
   - 타일 색상 → 러너 액션 연결
   - Red → Jump, Blue → Slide, Yellow → Block 등
   - `ColorActionMapper`: 색상-액션 매핑 테이블

3. **장애물 시스템**
   - `ObstacleSpawner`: 스테이지 진행도에 따른 장애물 생성
   - 장애물 예고 UI (Warning)
   - 제한 시간 내 올바른 액션 입력 판정
   - 성공/실패 처리 (스태미나 감소)

4. **스태미나 시스템**
   - 자연 감소 (`BaseDecayRate`)
   - 피격 대미지 적용
   - 회복 시스템 (타일 제거, Red 아이템)
   - **Phase 3 아이템 효과 이벤트 구독**:
     - `ItemEffectEvents.OnStaminaRecover` 구독 → Recovery 효과 처리
     - `ItemEffectEvents.OnTimeFreeze` 구독 → TimeFreeze 효과 처리

5. **진행도 시스템**
   - 스테이지 시작 → 보스 출현까지 진행률 표시
   - `ProgressBar`: 진행률 UI

6. **패럴랙스 배경**
   - `ParallaxController`: 배경 레이어 스크롤
   - 에피소드별 테마 배경

### 예상 소요 시간
**5-7일**

### 완료 기준
- 러너가 타일 매칭에 따라 액션을 수행함
- 장애물이 등장하고 올바른 액션으로 회피 가능
- 스태미나가 시간에 따라 감소하고 회복됨
- 진행도가 정확히 표시됨

---

## 📌 Phase 5: 보스 전투 시스템

### 목표
스테이지 보스와의 전투 시스템을 구현합니다.

### 작업 내용
1. **보스 기본 구조**
   - `BossController`: 보스 기본 동작
   - 보스 HP 시스템
   - 보스 등장 연출

2. **보스 패턴 시스템**
   - `BossPatternBase`: 패턴 추상 클래스
   - **TimeAttack 패턴**: 순차 색상 입력
   - **RhythmNote 패턴**: 리듬 노트 판정
   - **ColorQuota 패턴**: 색상별 목표 개수
   - **MemorySequence 패턴**: 순서 기억 입력

3. **보스 전투 루프**
   - 패턴 제시 → 입력/방어 → 보너스 타임 (Groggy)
   - 패턴 실패 시 스태미나 감소
   - 패턴 성공 시 보스 대미지

4. **보스 페이즈 전환**
   - HP 구간별 특수 패턴 발동 (50%, 20%)
   - 페이즈 전환 연출

5. **보스 전투 UI**
   - 보스 HP 바
   - 패턴별 전용 UI (노트 레일, 시퀀스 아이콘 등)
   - 타이머 표시

6. **Orange (PowerUp) 타일 효율**
   - 공격력 스탯에 따른 대미지 계산
   - Groggy 상태에서 대미지 증가
   - **Phase 3 아이템 효과 이벤트 구독**:
     - `ItemEffectEvents.OnAttackBuff` 구독 → PowerUp 효과 처리 (공격력 버프 적용)

### 예상 소요 시간
**7-10일**

### 완료 기준
- 보스가 등장하고 HP가 표시됨
- 4가지 패턴 타입이 모두 동작함
- 패턴 성공/실패 판정이 정확함
- 보스 처치 시 클리어 처리됨

---

## 📌 Phase 6: 성장 시스템 (캐릭터/장비)

### 목표
RPG 요소인 캐릭터와 장비 성장 시스템을 구현합니다.

### 작업 내용
1. **캐릭터 시스템**
   - `CharacterData`: 캐릭터 기본 정보
   - 스탯 시스템 (MaxHP, Attack, Recovery, Critical)
   - 캐릭터 조각 수집 (초기 비활성화, 데이터만 준비)
   - 승급 테이블 데이터 구조

2. **장비 시스템**
   - `EquipmentData`: 장비 정보
   - 보스 전용 장비 구조 (고정 옵션)
   - 장비 인스턴스 관리 (레벨, 옵션)

3. **장비 레벨업**
   - 코인 소모 레벨업 시스템
   - 레벨업 비용 테이블 (Lv.1~20)
   - 능력치 상승 적용

4. **장비 승급**
   - Lv.20 달성 + 재료 장비 2개
   - 보스 장비 승급 특례 (일반 장비 재료 허용)
   - 등급 상승 처리

5. **전리품 시스템**
   - `LootTableData`: 드롭 테이블 구조
   - 독립 시행 드롭 로직
   - 보스 처치 시 전리품 획득
   - 전리품 팝업 UI

6. **재화 시스템**
   - 코인 관리
   - 코인 획득/소모 처리

### 예상 소요 시간
**6-8일**

### 완료 기준
- 캐릭터 스탯이 장비에 따라 적용됨
- 장비 레벨업이 정확히 동작함
- 보스 처치 시 전리품이 드롭됨
- 보스 전용 장비가 획득 가능함

---

## 📌 Phase 7: UI/UX 구현

### 목표
Unity UI Toolkit을 사용한 모든 화면을 구현합니다.

### 작업 내용
1. **UI 인프라**
   - `UIManager`: UI 시스템 관리
   - `BaseUIView`: 화면 기본 클래스
   - 화면 전환 시스템

2. **로비 화면**
   - `UI_Title`: 타이틀 화면
   - `UI_Lobby`: 메인 로비
   - `UI_StageSelect`: 스테이지 선택
   - `UI_Equipment`: 장비 관리
   - `UI_Shop`: 상점

3. **인게임 HUD**
   - 상단 뷰 HUD (HP 바, 진행률 바, 일시정지)
   - 하단 뷰 퍼즐 그리드
   - 보스 전투 오버레이 UI
   - 아이템 슬롯

4. **결과 화면**
   - `UI_Result_Win`: 승리 화면 (전리품 표시)
   - `UI_Result_Lose`: 패배 화면 (이어하기 버튼)
   - `UI_Pause`: 일시정지 팝업

5. **USS 스타일링**
   - `TopViewStyle.uss`: 레트로 픽셀 아트 스타일
   - `BottomViewStyle.uss`: 모던 플랫 디자인
   - `Common.uss`: 공통 스타일

6. **반응형 레이아웃**
   - Flex Layout 활용
   - Safe Area 처리 (노치, 홈 바)

### 예상 소요 시간
**7-10일**

### 완료 기준
- 모든 화면이 UI Toolkit으로 구현됨
- 화면 전환이 부드럽게 동작함
- 반응형 레이아웃이 적용됨
- 스타일이 기획에 맞게 적용됨

---

## 📌 Phase 8: 밸런싱 및 최적화

### 목표
게임 밸런스를 조정하고 성능을 최적화합니다.

### 작업 내용
1. **밸런싱 데이터 조정**
   - 스태미나 감소율 조정
   - 점수 계산 계수 조정
   - 아이템 효과 수치 조정
   - 보스 HP/대미지 조정
   - 장비 능력치 조정

2. **성능 최적화**
   - Object Pooling 적용 (타일, VFX, 장애물)
   - Sprite Atlas 생성 및 적용
   - Draw Call 최적화
   - 메모리 사용량 최적화

3. **저장 시스템**
   - `SaveManager`: JSON 기반 저장 시스템
   - 암호화 적용 (선택사항)
   - 저장 항목:
     - 유저 재화
     - 보유 캐릭터/장비
     - 스테이지 클리어 정보

4. **광고 시스템 통합** (NineMood.Services)
   - 이어하기 광고
   - 무료 코인 광고
   - 보상 2배 광고

5. **사운드 시스템**
   - `AudioManager`: 사운드 재생 관리
   - BGM, SFX 재생
   - 볼륨 설정

6. **버그 수정 및 폴리싱**
   - 버그 수정
   - 연출 추가 (VFX, 애니메이션)
   - 튜토리얼 (선택사항)

### 예상 소요 시간
**5-7일**

### 완료 기준
- 게임 밸런스가 적절함
- 성능이 모바일에서 원활함
- 데이터가 정상적으로 저장/로드됨
- 광고가 정상 동작함

---

## 📊 전체 일정 요약

| Phase | 작업 내용 | 예상 소요 시간 |
|-------|----------|---------------|
| Phase 1 | 데이터 구조 및 인프라 | 3-5일 |
| Phase 2 | 퍼즐 시스템 핵심 | 5-7일 |
| Phase 3 | 특수 아이템 시스템 | 4-6일 |
| Phase 4 | 러너 시스템 및 장애물 | 5-7일 |
| Phase 5 | 보스 전투 시스템 | 7-10일 |
| Phase 6 | 성장 시스템 | 6-8일 |
| Phase 7 | UI/UX 구현 | 7-10일 |
| Phase 8 | 밸런싱 및 최적화 | 5-7일 |
| **총계** | | **42-60일** |

---

## 🎯 각 Phase 시작 전 체크리스트

각 Phase를 시작하기 전에 다음을 확인합니다:

1. ✅ 이전 Phase의 완료 기준이 모두 충족되었는가?
2. ✅ 필요한 ScriptableObject 데이터가 준비되었는가?
3. ✅ 기획서의 해당 섹션을 다시 확인했는가?
4. ✅ 테스트 시나리오가 준비되었는가?

---

## 📝 작업 진행 방식

1. **각 Phase는 독립적으로 진행**
   - Phase 완료 후 테스트 및 검증
   - 문제 발견 시 해당 Phase 내에서 수정

2. **데이터 주도 설계**
   - 모든 수치는 ScriptableObject로 관리
   - 코드 수정 없이 밸런싱 가능하도록 설계

3. **확장성 고려**
   - 추후 기능 추가를 고려한 구조 설계
   - 캐릭터 승급 등은 데이터만 준비하고 기능은 비활성화

4. **단계별 테스트**
   - 각 Phase마다 플레이 가능한 상태로 완성
   - 다음 Phase로 넘어가기 전 검증

---

## 🔄 보완 사항 반영

V2.0 기획서의 보완 사항을 각 Phase에 반영:

- ✅ **게임 설명 보충**: Phase 7 UI 구현 시 반영
- ✅ **헥사곤 vs 사각형 비교**: Phase 2에서 벌집형 그리드로 확정
- ✅ **캐릭터 구매/승급**: Phase 6에서 데이터 구조 준비 (기능은 후순위)
- ✅ **아이템 드랍**: Phase 6 전리품 시스템에 반영
- ✅ **장비 레벨업 경험치**: Phase 6에서 코인 직접 지불 방식으로 구현
- ✅ **밸런싱 데이터 외부화**: Phase 1에서 구조 설계, 모든 Phase에서 적용

---

## 📌 다음 단계

**Phase 1부터 시작**하여 순차적으로 진행합니다.

각 Phase가 완료되면 다음 Phase로 넘어가며, 필요시 이전 Phase를 수정할 수 있습니다.

준비가 되면 Phase 1 작업을 시작하겠습니다! 🚀
